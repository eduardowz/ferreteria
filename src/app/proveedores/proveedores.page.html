<ion-header>
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <!-- TÃ­tulo dinÃ¡mico segÃºn el rol -->
      <span *ngIf="isAdmin">ğŸ­ GestiÃ³n de Proveedores</span>
      <span *ngIf="!isAdmin">ğŸ“Š Mis Pedidos y Proveedores</span>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- =================== VISTA PARA ADMINISTRADORES =================== -->
  <div *ngIf="isAdmin">
    
    <!-- EstadÃ­sticas rÃ¡pidas para admin -->
    <ion-card class="stats-card" *ngIf="comprasFiltradas.length > 0">
      <ion-card-header>
        <ion-card-title>
          <span class="emoji-icon">ğŸ“Š</span>
          EstadÃ­sticas RÃ¡pidas
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-box">
            <span class="stat-emoji">â³</span>
            <span class="stat-count">{{ obtenerComprasPorEstado('Pendiente') }}</span>
            <span class="stat-title">Pendientes</span>
          </div>
          <div class="stat-box">
            <span class="stat-emoji">ğŸšš</span>
            <span class="stat-count">{{ obtenerComprasPorEstado('Enviado') }}</span>
            <span class="stat-title">Enviados</span>
          </div>
          <div class="stat-box">
            <span class="stat-emoji">âœ…</span>
            <span class="stat-count">{{ obtenerComprasPorEstado('Entregado') }}</span>
            <span class="stat-title">Entregados</span>
          </div>
          <div class="stat-box">
            <span class="stat-emoji">ğŸ</span>
            <span class="stat-count">${{ calcularTotalDescuentosAplicados().toFixed(2) }}</span>
            <span class="stat-title">Descuentos</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- GestiÃ³n de proveedores (funcionalidad original) -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>GestiÃ³n de Proveedores</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-button 
          expand="block" 
          color="primary" 
          (click)="mostrarFormulario = !mostrarFormulario">
          <ion-icon name="add" slot="start"></ion-icon>
          {{ mostrarFormulario ? 'Cancelar' : 'Agregar Proveedor' }}
        </ion-button>

        <!-- Formulario de proveedor -->
        <div *ngIf="mostrarFormulario" class="form-container">
          <ion-item>
            <ion-label position="stacked">Nombre</ion-label>
            <ion-input [(ngModel)]="nuevoProveedor.nombre" placeholder="Nombre del proveedor"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="stacked">TelÃ©fono</ion-label>
            <ion-input [(ngModel)]="nuevoProveedor.telefono" placeholder="TelÃ©fono"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="stacked">Empresa</ion-label>
            <ion-input [(ngModel)]="nuevoProveedor.empresa" placeholder="Empresa"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="stacked">Correo</ion-label>
            <ion-input [(ngModel)]="nuevoProveedor.correo" placeholder="Correo electrÃ³nico"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="stacked">Fecha</ion-label>
            <ion-input [(ngModel)]="nuevoProveedor.fecha" type="date"></ion-input>
          </ion-item>

          <ion-button 
            expand="block" 
            color="success" 
            (click)="guardarProveedor()" 
            style="margin-top: 16px;">
            <ion-icon name="save" slot="start"></ion-icon>
            Guardar
          </ion-button>
        </div>

        <!-- Lista de proveedores -->
        <ion-list *ngIf="proveedores.length > 0">
          <ion-item *ngFor="let proveedor of proveedores; let i = index">
            <ion-label>
              <h3>{{ proveedor.nombre }}</h3>
              <p>{{ proveedor.empresa }} - {{ proveedor.telefono }}</p>
              <p>{{ proveedor.correo }} - {{ proveedor.fecha }}</p>
            </ion-label>
            <ion-button fill="clear" color="primary" (click)="editarProveedor(i)">
              <ion-icon name="create"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="eliminarProveedor(i)">
              <ion-icon name="trash"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

  </div>

  <!-- =================== VISTA PARA USUARIOS =================== -->
  <div *ngIf="!isAdmin">
    
    <!-- Header de bienvenida al usuario -->
    <div class="user-welcome">
      <div class="user-name">ğŸ“Š Estado de mis Pedidos</div>
      <div class="user-subtitle">Revisa el estado de tus compras y conoce a nuestros proveedores de confianza</div>
    </div>

    <!-- EstadÃ­sticas de pedidos del usuario -->
    <ion-card class="stats-card" *ngIf="misCompras.length > 0">
      <ion-card-header>
        <ion-card-title>
          <span class="emoji-icon">ğŸ“ˆ</span>
          Estado de mis Pedidos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-box pending">
            <span class="stat-emoji">â³</span>
            <span class="stat-count">{{ obtenerMisPedidosPorEstado('Pendiente') }}</span>
            <span class="stat-title">En Proceso</span>
          </div>
          <div class="stat-box shipped">
            <span class="stat-emoji">ğŸšš</span>
            <span class="stat-count">{{ obtenerMisPedidosPorEstado('Enviado') }}</span>
            <span class="stat-title">Enviados</span>
          </div>
          <div class="stat-box delivered">
            <span class="stat-emoji">âœ…</span>
            <span class="stat-count">{{ obtenerMisPedidosPorEstado('Entregado') }}</span>
            <span class="stat-title">Entregados</span>
          </div>
          <div class="stat-box discount">
            <span class="stat-emoji">ğŸ</span>
            <span class="stat-count">{{ calcularDescuentoProximoEnvio() }}%</span>
            <span class="stat-title">PrÃ³ximo Descuento</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- InformaciÃ³n de descuento prÃ³ximo envÃ­o -->
    <ion-card class="discount-info-card" *ngIf="misCompras.length > 0">
      <ion-card-header>
        <ion-card-title>
          <span class="emoji-icon">ğŸ¯</span>
          Programa de Descuentos
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="discount-info">
          <div class="current-progress">
            <span class="progress-label">Pedidos realizados: <strong>{{ misCompras.length }}</strong></span>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="(misCompras.length / obtenerPedidosParaDescuento()) * 100"></div>
            </div>
            <span class="progress-text">{{ misCompras.length }}/{{ obtenerPedidosParaDescuento() }} pedidos</span>
          </div>
          
          <div class="discount-message">
            <span *ngIf="calcularDescuentoProximoEnvio() > 0" class="discount-earned">
              ğŸ‰ Â¡Has ganado {{ calcularDescuentoProximoEnvio() }}% de descuento en tu prÃ³xima compra!
            </span>
            <span *ngIf="calcularDescuentoProximoEnvio() === 0" class="discount-pending">
              ğŸ“¦ Realiza {{ obtenerPedidosParaDescuento() - misCompras.length }} pedidos mÃ¡s para obtener un descuento especial
            </span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Resumen rÃ¡pido de pedidos recientes -->
    <ion-card class="recent-orders-card" *ngIf="misCompras.length > 0">
      <ion-card-header>
        <ion-card-title>
          <span class="emoji-icon">ğŸ“¦</span>
          Mis Pedidos Recientes
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="recent-orders">
          <div *ngFor="let compra of obtenerPedidosRecientes(); let i = index" class="order-summary">
            <div class="order-info">
              <div class="order-header">
                <span class="order-emoji">{{ obtenerEmojiEstado(compra.estado) }}</span>
                <span class="order-id">Pedido #{{ compra.id }}</span>
                <ion-badge [color]="obtenerColorEstado(compra.estado)" class="order-status">
                  {{ compra.estado }}
                </ion-badge>
              </div>
              <div class="order-details">
                <span class="order-date">{{ formatearFecha(compra.fecha) }}</span>
                <span class="order-total">${{ compra.total.toFixed(2) }}</span>
              </div>
              <div class="order-products">
                {{ obtenerResumenProductos(compra.productos) }}
              </div>
            </div>
          </div>
        </div>
        
        <ion-button 
          expand="block" 
          fill="outline" 
          color="primary"
          routerLink="/compras"
          style="margin-top: 15px;">
          <ion-icon name="list-outline" slot="start"></ion-icon>
          Ver todos mis pedidos
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- InformaciÃ³n de proveedores -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>
          <span class="emoji-icon">ğŸ­</span>
          Nuestros Proveedores de Confianza
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="info-content">
          <div class="feature-item">
            <span class="feature-icon">âœ…</span>
            <span>Productos de calidad certificada</span>
          </div>
          <div class="feature-item">
            <span class="feature-icon">ğŸšš</span>
            <span>Entregas puntuales y confiables</span>
          </div>
          <div class="feature-item">
            <span class="feature-icon">ğŸ’°</span>
            <span>Precios competitivos del mercado</span>
          </div>
          <div class="feature-item">
            <span class="feature-icon">ğŸ”§</span>
            <span>Soporte tÃ©cnico especializado</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>



    <!-- Estado vacÃ­o cuando no hay pedidos -->
    <div *ngIf="misCompras.length === 0" class="empty-state">
      <span class="empty-emoji">ğŸ“¦</span>
      <h3>AÃºn no tienes pedidos</h3>
      <p>Â¡Realiza tu primera compra y comienza a ganar descuentos!</p>
      
      <ion-card class="empty-card">
        <ion-card-header>
          <ion-card-title>ğŸ›’ Â¡Comienza a comprar!</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Descubre nuestros productos y aprovecha las ofertas especiales para nuevos clientes.</p>
          
          <ion-button expand="block" color="primary" routerLink="/productos">
            <ion-icon name="storefront-outline" slot="start"></ion-icon>
            Ver Productos
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- BotÃ³n para refrescar -->
    <div class="refresh-section">
      <ion-button 
        expand="block" 
        fill="outline" 
        color="medium"
        (click)="refrescarDatos()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Actualizar informaciÃ³n
      </ion-button>
    </div>

  </div>

</ion-content>